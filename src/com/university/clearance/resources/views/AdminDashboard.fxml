<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.Tab?>
<?import javafx.scene.control.TabPane?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.text.Font?>
<?import javafx.scene.text.Text?>
<?import javafx.scene.text.TextFlow?>

<BorderPane xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1" 
            fx:controller="com.university.clearance.controller.AdminDashboardController">
    
    <top>
        <HBox alignment="CENTER_LEFT" spacing="20" style="-fx-background-color: #2c3e50; -fx-padding: 15;">
            <children>
                <Label text="University Clearance System" textFill="WHITE">
                    <font>
                        <Font name="System Bold" size="18.0" />
                    </font>
                </Label>
                <Label fx:id="lblWelcome" textFill="WHITE">
                    <font>
                        <Font name="System" size="14.0" />
                    </font>
                </Label>
                <Region HBox.hgrow="ALWAYS" />
                <HBox alignment="CENTER_RIGHT" spacing="20">
                    <Label fx:id="lblTotalStudents" style="-fx-text-fill: #ecf0f1; -fx-font-weight: bold;" text="Students: 0" />
                    <Label fx:id="lblTotalOfficers" style="-fx-text-fill: #ecf0f1; -fx-font-weight: bold;" text="Officers: 0" />
                    <Label fx:id="lblTotalRequests" style="-fx-text-fill: #ecf0f1; -fx-font-weight: bold;" text="Requests: 0" />
                </HBox>
                <Button onAction="#handleLogout" style="-fx-background-color: #e74c3c; -fx-text-fill: white; -fx-font-weight: bold;" text="Logout" />
            </children>
        </HBox>
    </top>
    
    <left>
        <VBox minWidth="220" spacing="10" style="-fx-background-color: #34495e; -fx-padding: 15;">
            <children>
                <Label style="-fx-text-fill: #ecf0f1; -fx-font-weight: bold; -fx-padding: 0 0 5 0;" text="USER MANAGEMENT" />
                
                <!-- Registration Buttons -->
                <Button onAction="#openRegisterStudent" style="-fx-background-color: #27ae60; -fx-text-fill: white; -fx-pref-width: 200; -fx-font-weight: bold;" 
                        text="âž• Register Student" />
                <Button onAction="#openManageOfficers" style="-fx-background-color: #3498db; -fx-text-fill: white; -fx-pref-width: 200; -fx-font-weight: bold;" 
                        text="ðŸ‘¨â€ðŸ’¼ Register Officer" />
                <Button onAction="#resetUserPassword" style="-fx-background-color: #2980b9; -fx-text-fill: white; -fx-pref-width: 200;" 
                        text="ðŸ”‘ Reset Password" />
                <Button onAction="#toggleUserStatus" style="-fx-background-color: #2980b9; -fx-text-fill: white; -fx-pref-width: 200;" 
                        text="ðŸ”„ Toggle Status" />
                
                <Separator style="-fx-padding: 10 0 10 0;" />
                
                <Label style="-fx-text-fill: #ecf0f1; -fx-font-weight: bold; -fx-padding: 0 0 5 0;" text="SYSTEM CONFIGURATION" />
                
                <Button onAction="#openWorkflowManagement" style="-fx-background-color: #2980b9; -fx-text-fill: white; -fx-pref-width: 200;" 
                        text="âš™ï¸ Approval Workflow" />
                <Button onAction="#openSessionManagement" style="-fx-background-color: #2980b9; -fx-text-fill: white; -fx-pref-width: 200;" 
                        text="ðŸ“… Academic Sessions" />
                <Button onAction="#processSemesterRollover" style="-fx-background-color: #f39c12; -fx-text-fill: white; -fx-pref-width: 200; -fx-font-weight: bold;" 
                        text="ðŸ”„ Semester Rollover" />
                
                <Separator style="-fx-padding: 10 0 10 0;" />
                
                <Label style="-fx-text-fill: #ecf0f1; -fx-font-weight: bold; -fx-padding: 0 0 5 0;" text="CERTIFICATES" />
                
                <Button onAction="#generateClearanceCertificates" style="-fx-background-color: #2980b9; -fx-text-fill: white; -fx-pref-width: 200;" 
                        text="ðŸ“„ Generate Certificates" />
                <Button onAction="#openCertificateVerification" style="-fx-background-color: #2980b9; -fx-text-fill: white; -fx-pref-width: 200;" 
                        text="âœ… Verify Certificate" />
                <Button onAction="#verifyCertificate" style="-fx-background-color: #2980b9; -fx-text-fill: white; -fx-pref-width: 200;" 
                        text="ðŸ” Verify (New)" />
                
                <Separator style="-fx-padding: 10 0 10 0;" />
                
                <Label style="-fx-text-fill: #ecf0f1; -fx-font-weight: bold; -fx-padding: 0 0 5 0;" text="QUICK ACTIONS" />
                
                <Button onAction="#handleRefresh" style="-fx-background-color: #2ecc71; -fx-text-fill: white; -fx-pref-width: 200; -fx-font-weight: bold;" 
                        text="ðŸ”„ Refresh All" />
            </children>
        </VBox>
    </left>
    
    <center>
        <TabPane fx:id="mainTabPane" style="-fx-padding: 10; -fx-background-color: #2980b9;" tabClosingPolicy="UNAVAILABLE">
            
            <Tab text="ðŸ  Dashboard">
                <ScrollPane fitToWidth="true" fitToHeight="true">
                    <VBox spacing="20" style="-fx-padding: 20;">
                        <Label style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;" text="Admin Dashboard Overview" />
                        
                        <HBox spacing="20">
                            <VBox prefWidth="250" style="-fx-background-color: #3498db; -fx-padding: 20; -fx-background-radius: 10;">
                                <Label style="-fx-text-fill: white; -fx-font-size: 16px;" text="Total Students" />
                                <Label fx:id="lblTotalStudentsCard" style="-fx-text-fill: white; -fx-font-size: 32px; -fx-font-weight: bold;" text="0" />
                            </VBox>
                            
                            <VBox prefWidth="250" style="-fx-background-color: #2ecc71; -fx-padding: 20; -fx-background-radius: 10;">
                                <Label style="-fx-text-fill: white; -fx-font-size: 16px;" text="Total Officers" />
                                <Label fx:id="lblTotalOfficersCard" style="-fx-text-fill: white; -fx-font-size: 32px; -fx-font-weight: bold;" text="0" />
                            </VBox>
                            
                            <VBox prefWidth="250" style="-fx-background-color: #e74c3c; -fx-padding: 20; -fx-background-radius: 10;">
                                <Label style="-fx-text-fill: white; -fx-font-size: 16px;" text="Total Requests" />
                                <Label fx:id="lblTotalRequestsCard" style="-fx-text-fill: white; -fx-font-size: 32px; -fx-font-weight: bold;" text="0" />
                            </VBox>
                        </HBox>
                        
                        <HBox spacing="20">
                            <VBox prefWidth="250" style="-fx-background-color: #27ae60; -fx-padding: 20; -fx-background-radius: 10;">
                                <Label style="-fx-text-fill: white; -fx-font-size: 16px;" text="âœ… Approved" />
                                <Label fx:id="lblApprovedCount" style="-fx-text-fill: white; -fx-font-size: 32px; -fx-font-weight: bold;" text="0" />
                            </VBox>
                            
                            <VBox prefWidth="250" style="-fx-background-color: #e74c3c; -fx-padding: 20; -fx-background-radius: 10;">
                                <Label style="-fx-text-fill: white; -fx-font-size: 16px;" text="âŒ Rejected" />
                                <Label fx:id="lblRejectedCount" style="-fx-text-fill: white; -fx-font-size: 32px; -fx-font-weight: bold;" text="0" />
                            </VBox>
                            
                            <VBox prefWidth="250" style="-fx-background-color: #f39c12; -fx-padding: 20; -fx-background-radius: 10;">
                                <Label style="-fx-text-fill: white; -fx-font-size: 16px;" text="â³ Pending" />
                                <Label fx:id="lblPendingCount" style="-fx-text-fill: white; -fx-font-size: 32px; -fx-font-weight: bold;" text="0" />
                            </VBox>
                        </HBox>
                        
                        <VBox spacing="10" style="-fx-background-color: #f8f9fa; -fx-padding: 20; -fx-background-radius: 10;">
                            <Label style="-fx-font-size: 18px; -fx-font-weight: bold;" text="Quick Statistics" />
                            <TextFlow>
                                <Text text="Use the sidebar menu to access all administration features.&#10;&#10;" />
                                <Text style="-fx-font-weight: bold;" text="Student Clearance Status:" />
                                <Text text="&#10;â€¢ âœ… Approved: Students with fully cleared requests" />
                                <Text text="&#10;â€¢ âŒ Rejected: Students whose requests were rejected" />
                                <Text text="&#10;â€¢ â³ Pending: Students with pending requests" />
                                <Text text="&#10;â€¢ ðŸ”„ In Progress: Requests currently being processed" />
                                <Text text="&#10;&#10;" />
                                <Text style="-fx-font-weight: bold;" text="Registration Features:" />
                                <Text text="&#10;â€¢ Student Registration: Real-time validation with auto-generated username" />
                                <Text text="&#10;â€¢ Officer Registration: Role-based department validation" />
                                <Text text="&#10;â€¢ Live validation: Red error messages, green âœ“ for valid inputs" />
                            </TextFlow>
                        </VBox>
                    </VBox>
                </ScrollPane>
            </Tab>
            
            <Tab text="ðŸ‘¥ All Users">
                <VBox spacing="15">
                    <padding>
                        <Insets bottom="15.0" left="15.0" right="15.0" top="15.0" />
                    </padding>
                    
                    <!-- Search Header Section -->
                    <VBox spacing="10">
                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label style="-fx-font-weight: bold; -fx-font-size: 16px;" text="All System Users" />
                            <Region HBox.hgrow="ALWAYS" />
                            
                            <!-- Search Type ComboBox -->
                            <ComboBox fx:id="cmbSearchType" prefWidth="130" />
                            
                            <!-- Search Text Field -->
                            <TextField fx:id="txtSearchUsers" prefWidth="250" promptText="Search by ID, name, department..." />
                            
                            <!-- Search Button -->
                            <Button fx:id="btnSearchUsers" onAction="#handleUserSearch" 
                                    style="-fx-background-color: #3498db; -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 5 15;" 
                                    text="ðŸ” Search" />
                            
                            <!-- Clear Button -->
                            <Button fx:id="btnClearSearch" onAction="#handleClearSearch" 
                                    style="-fx-background-color: #95a5a6; -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 5 15;" 
                                    text="âŒ Clear" />
                        </HBox>
                        
                        <!-- Search Status Label -->
                        <Label fx:id="lblSearchStatus" 
                               style="-fx-text-fill: #3498db; -fx-font-size: 12px;"
                               visible="false" />
                    </VBox>
                    
                    <!-- Users Table -->
                    <TableView fx:id="tableAllUsers" prefHeight="500">
                        <columns>
                            <TableColumn fx:id="colAllUserId" prefWidth="120" text="Username" />
                            <TableColumn fx:id="colAllUserName" prefWidth="200" text="Full Name" />
                            <TableColumn fx:id="colAllUserRole" prefWidth="120" text="Role" />
                            <TableColumn fx:id="colAllUserDepartment" prefWidth="150" text="Department" />
                            <TableColumn fx:id="colAllUserStatus" prefWidth="100" text="Status" />
                        </columns>
                    </TableView>
                </VBox>
            </Tab>
            
            <Tab text="ðŸŽ“ Students">
                <TabPane tabClosingPolicy="UNAVAILABLE">
                    <Tab text="ðŸ“‹ All Students">
                        <VBox spacing="15">
                            <padding>
                                <Insets bottom="15.0" left="15.0" right="15.0" top="15.0" />
                            </padding>
                            
                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <Label style="-fx-font-weight: bold; -fx-font-size: 16px;" text="All Students" />
                                <Region HBox.hgrow="ALWAYS" />
                            </HBox>
                            
                            <TableView fx:id="tableAllStudents" prefHeight="500">
                                <columns>
                                    <TableColumn fx:id="colStudentId" prefWidth="120" text="Student ID" />
                                    <TableColumn fx:id="colStudentName" prefWidth="200" text="Full Name" />
                                    <TableColumn fx:id="colStudentDepartment" prefWidth="150" text="Department" />
                                    <TableColumn fx:id="colStudentYear" prefWidth="100" text="Year" />
                                    <TableColumn fx:id="colClearanceStatus" prefWidth="120" text="Status" />
                                    <TableColumn fx:id="colStudentActions" prefWidth="200" text="Actions" />
                                </columns>
                            </TableView>
                        </VBox>
                    </Tab>
                    
                    <Tab text="âœ… Approved">
                        <VBox spacing="15">
                            <padding>
                                <Insets bottom="15.0" left="15.0" right="15.0" top="15.0" />
                            </padding>
                            
                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <Label style="-fx-font-weight: bold; -fx-font-size: 16px;" text="Approved Students" />
                                <Region HBox.hgrow="ALWAYS" />
                            </HBox>
                            
                            <TableView fx:id="tableApprovedStudents" prefHeight="500">
                                <columns>
                                    <TableColumn prefWidth="120" text="Student ID" />
                                    <TableColumn prefWidth="200" text="Full Name" />
                                    <TableColumn prefWidth="150" text="Department" />
                                    <TableColumn prefWidth="120" text="Status" />
                                </columns>
                            </TableView>
                        </VBox>
                    </Tab>
                    
                    <Tab text="âŒ Rejected">
                        <VBox spacing="15">
                            <padding>
                                <Insets bottom="15.0" left="15.0" right="15.0" top="15.0" />
                            </padding>
                            
                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <Label style="-fx-font-weight: bold; -fx-font-size: 16px;" text="Rejected Students" />
                                <Region HBox.hgrow="ALWAYS" />
                            </HBox>
                            
                            <TableView fx:id="tableRejectedStudents" prefHeight="500">
                                <columns>
                                    <TableColumn prefWidth="120" text="Student ID" />
                                    <TableColumn prefWidth="200" text="Full Name" />
                                    <TableColumn prefWidth="150" text="Department" />
                                    <TableColumn prefWidth="120" text="Status" />
                                    <TableColumn prefWidth="200" text="Actions" />
                                </columns>
                            </TableView>
                        </VBox>
                    </Tab>
                    
                    <Tab text="â³ Pending">
                        <VBox spacing="15">
                            <padding>
                                <Insets bottom="15.0" left="15.0" right="15.0" top="15.0" />
                            </padding>
                            
                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <Label style="-fx-font-weight: bold; -fx-font-size: 16px;" text="Pending Students" />
                                <Region HBox.hgrow="ALWAYS" />
                            </HBox>
                            
                            <TableView fx:id="tablePendingStudents" prefHeight="500">
                                <columns>
                                    <TableColumn prefWidth="120" text="Student ID" />
                                    <TableColumn prefWidth="200" text="Full Name" />
                                    <TableColumn prefWidth="150" text="Department" />
                                    <TableColumn prefWidth="120" text="Status" />
                                </columns>
                            </TableView>
                        </VBox>
                    </Tab>
                    
                    <Tab text="ðŸ”„ In Progress">
                        <VBox spacing="15">
                            <padding>
                                <Insets bottom="15.0" left="15.0" right="15.0" top="15.0" />
                            </padding>
                            
                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <Label style="-fx-font-weight: bold; -fx-font-size: 16px;" text="In Progress Students" />
                                <Region HBox.hgrow="ALWAYS" />
                            </HBox>
                            
                            <TableView fx:id="tableInProgressStudents" prefHeight="500">
                                <columns>
                                    <TableColumn prefWidth="120" text="Student ID" />
                                    <TableColumn prefWidth="200" text="Full Name" />
                                    <TableColumn prefWidth="150" text="Department" />
                                    <TableColumn prefWidth="120" text="Status" />
                                </columns>
                            </TableView>
                        </VBox>
                    </Tab>
                </TabPane>
            </Tab>
            
            <Tab text="ðŸ‘¨â€ðŸ’¼ Officers">
                <VBox spacing="15">
                    <padding>
                        <Insets bottom="15.0" left="15.0" right="15.0" top="15.0" />
                    </padding>
                    
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <Label style="-fx-font-weight: bold; -fx-font-size: 16px;" text="All Officers" />
                        <Region HBox.hgrow="ALWAYS" />
                    </HBox>
                    
                    <TableView fx:id="tableOfficers" prefHeight="500">
                        <columns>
                            <TableColumn fx:id="colOfficerId" prefWidth="120" text="Username" />
                            <TableColumn fx:id="colOfficerName" prefWidth="200" text="Full Name" />
                            <TableColumn fx:id="colOfficerRole" prefWidth="120" text="Role" />
                            <TableColumn fx:id="colOfficerDepartment" prefWidth="150" text="Department" />
                            <TableColumn fx:id="colOfficerStatus" prefWidth="100" text="Status" />
                        </columns>
                    </TableView>
                </VBox>
            </Tab>
            
            <Tab text="ðŸ“ Clearance Requests">
                <VBox spacing="15">
                    <padding>
                        <Insets bottom="15.0" left="15.0" right="15.0" top="15.0" />
                    </padding>
                    
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <Label style="-fx-font-weight: bold; -fx-font-size: 16px;" text="All Clearance Requests" />
                        <TextField fx:id="txtSearchRequests" prefWidth="300" promptText="Search by student ID or name" />
                        <Region HBox.hgrow="ALWAYS" />
                        <Button fx:id="btnSearchRequests" onAction="#handleRequestsSearch" 
                                style="-fx-background-color: #3498db; -fx-text-fill: white; -fx-font-weight: bold;" 
                                text="ðŸ” Search" />
                        <Button fx:id="btnClearRequestsSearch" onAction="#handleClearRequestsSearch" 
                                style="-fx-background-color: #95a5a6; -fx-text-fill: white; -fx-font-weight: bold;" 
                                text="âŒ Clear" />
                        <Button onAction="#handleRefresh" 
                                style="-fx-background-color: #27ae60; -fx-text-fill: white; -fx-font-weight: bold;" 
                                text="ðŸ”„ Refresh" />
                    </HBox>
                    
                    <TableView fx:id="tableRequests" prefHeight="500">
                        <columns>
                            <TableColumn fx:id="colRequestStudentId" prefWidth="120" text="Student ID" />
                            <TableColumn fx:id="colRequestName" prefWidth="200" text="Full Name" />
                            <TableColumn fx:id="colRequestDepartment" prefWidth="150" text="Department" />
                            <TableColumn fx:id="colRequestStatus" prefWidth="120" text="Status" />
                            <TableColumn fx:id="colRequestDate" prefWidth="150" text="Request Date" />
                            <TableColumn fx:id="colRequestApproved" prefWidth="100" text="Approved" />
                        </columns>
                    </TableView>
                </VBox>
            </Tab>
            
            <Tab text="ðŸ“Š Reports">
                <ScrollPane fitToWidth="true" fitToHeight="true">
                    <VBox spacing="20" style="-fx-padding: 20;">
                        <Label style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;" text="System Reports &amp; Analytics" />
                        
                        <HBox spacing="20">
                            <VBox prefWidth="250" style="-fx-background-color: #27ae60; -fx-padding: 20; -fx-background-radius: 10;">
                                <Label style="-fx-text-fill: white; -fx-font-size: 16px;" text="âœ… Approved" />
                                <Label fx:id="lblApprovedCount" style="-fx-text-fill: white; -fx-font-size: 32px; -fx-font-weight: bold;" text="0" />
                            </VBox>
                            
                            <VBox prefWidth="250" style="-fx-background-color: #e74c3c; -fx-padding: 20; -fx-background-radius: 10;">
                                <Label style="-fx-text-fill: white; -fx-font-size: 16px;" text="âŒ Rejected" />
                                <Label fx:id="lblRejectedCount" style="-fx-text-fill: white; -fx-font-size: 32px; -fx-font-weight: bold;" text="0" />
                            </VBox>
                            
                            <VBox prefWidth="250" style="-fx-background-color: #f39c12; -fx-padding: 20; -fx-background-radius: 10;">
                                <Label style="-fx-text-fill: white; -fx-font-size: 16px;" text="â³ Pending" />
                                <Label fx:id="lblPendingCount" style="-fx-text-fill: white; -fx-font-size: 32px; -fx-font-weight: bold;" text="0" />
                            </VBox>
                        </HBox>
                        
                        <VBox spacing="15" style="-fx-background-color: #ecf0f1; -fx-padding: 20; -fx-background-radius: 10;">
                            <Label style="-fx-font-size: 18px; -fx-font-weight: bold;" text="Available Reports" />
                            <VBox spacing="5">
                                <Label style="-fx-font-weight: bold;" text="â€¢ ðŸ“ˆ Clearance Status Report" />
                                <Label style="-fx-font-weight: bold;" text="â€¢ ðŸ“„ Certificate Generation Logs" />
                                <Label style="-fx-font-weight: bold;" text="â€¢ ðŸ‘¨â€ðŸ’¼ Officer Approval Performance" />
                                <Label style="-fx-font-weight: bold;" text="â€¢ ðŸ“š Student Clearance History" />
                                <Label style="-fx-font-weight: bold;" text="â€¢ ðŸ« Department-wise Clearance Statistics" />
                                <Label style="-fx-font-weight: bold;" text="â€¢ ðŸ“ Registration Audit Logs" />
                            </VBox>
                            <HBox spacing="10">
                                <Button onAction="#generateClearanceCertificates" 
                                        style="-fx-background-color: #2980b9; -fx-text-fill: white; -fx-pref-width: 200;" 
                                        text="ðŸ“„ Generate Certificates" />
                                <Button onAction="#verifyCertificate" 
                                        style="-fx-background-color: #27ae60; -fx-text-fill: white; -fx-pref-width: 200;" 
                                        text="âœ… Verify Certificate" />
                            </HBox>
                        </VBox>
                        
                        <VBox spacing="15" style="-fx-background-color: #f8f9fa; -fx-padding: 20; -fx-background-radius: 10;">
                            <Label style="-fx-font-size: 18px; -fx-font-weight: bold;" text="Recent Activities" />
                            <TextFlow>
                                <Text text="System provides real-time validation for all registrations:&#10;&#10;" />
                                <Text style="-fx-font-weight: bold;" text="Student Registration Features:" />
                                <Text text="&#10;â€¢ Auto-generated username from Student ID" />
                                <Text text="&#10;â€¢ Real-time validation for all fields" />
                                <Text text="&#10;â€¢ Phone number validation (09/07 + 8 digits)" />
                                <Text text="&#10;â€¢ Email format validation (optional)" />
                                <Text text="&#10;â€¢ Password strength validation (letters &amp; numbers)" />
                                <Text text="&#10;â€¢ Block (1-10) and Room (100-4999) number validation" />
                                <Text text="&#10;&#10;" />
                                <Text style="-fx-font-weight: bold;" text="Officer Registration Features:" />
                                <Text text="&#10;â€¢ University email validation (@dbu.edu.et)" />
                                <Text text="&#10;â€¢ Strong password requirements" />
                                <Text text="&#10;â€¢ Role-department relationship validation" />
                                <Text text="&#10;â€¢ Department head replacement confirmation" />
                            </TextFlow>
                        </VBox>
                    </VBox>
                </ScrollPane>
            </Tab>
            
        </TabPane>
    </center>
    
</BorderPane>