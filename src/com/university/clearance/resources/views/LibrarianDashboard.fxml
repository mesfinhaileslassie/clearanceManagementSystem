<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.Tab?>
<?import javafx.scene.control.TabPane?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.ColumnConstraints?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.RowConstraints?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.text.Font?>

<BorderPane stylesheets="@../css/dashboard.css" xmlns="http://javafx.com/javafx/25" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.university.clearance.controller.LibrarianDashboardController">
    
    <top>
        <HBox alignment="CENTER_LEFT" spacing="20" styleClass="header">
            <children>
                <Label styleClass="header-label" text="Debre Birhan University - Library Clearance System">
                    <font>
                        <Font name="System Bold" size="18.0" />
                    </font>
                </Label>
                <Label fx:id="lblWelcome" styleClass="welcome-label" text="Welcome, Librarian" />
                <Region HBox.hgrow="ALWAYS" />
                <Label fx:id="lblPendingCount" styleClass="stat-label-info" text="Pending: 0" />
                <Button fx:id="btnLogout" onAction="#handleLogout" styleClass="danger-button" text="Logout" />
            </children>
        </HBox>
    </top>
    
    <left>
        <VBox minWidth="200" spacing="10" styleClass="sidebar">
            <children>
                <Label styleClass="sidebar-title" text="LIBRARY DASHBOARD" />
                
                <Button onAction="#refreshRequests" prefHeight="35" prefWidth="180" styleClass="primary-button" text="ðŸ”„ Refresh Requests" />
                
                <Label styleClass="sidebar-title" text="LIBRARY STATISTICS" />
            </children>
        </VBox>
    </left>
    
    <center>
        <TabPane fx:id="mainTabPane" tabClosingPolicy="UNAVAILABLE">
            
            <!-- Clearance Requests Tab -->
            <Tab text="ðŸ“‹ Clearance Requests">
                <VBox spacing="15">
                    <padding>
                        <Insets bottom="15.0" left="15.0" right="15.0" top="15.0" />
                    </padding>
                    
                    <!-- Header -->
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <Label styleClass="title-label" text="Pending Library Clearance Approvals" />
                        <Region HBox.hgrow="ALWAYS" />
                        <Button onAction="#refreshRequests" prefHeight="35" styleClass="refresh-button" text="ðŸ”„ Refresh" />
                    </HBox>
                    
                    <!-- Quick Stats Bar -->
                    <HBox spacing="20" styleClass="stats-bar">
                        <Label style="-fx-font-weight: bold;" text="Total:" />
                        <Label fx:id="lblTotalRequests" styleClass="stat-label" text="0" />
                        
                        <Separator orientation="VERTICAL" />
                        
                        <HBox spacing="5">
                            <Label style="-fx-text-fill: #27ae60; -fx-font-weight: bold;" text="â—" />
                            <Label fx:id="lblClearCount" text="Clear: 0" />
                        </HBox>
                        
                        <Separator orientation="VERTICAL" />
                        
                        <HBox spacing="5">
                            <Label style="-fx-text-fill: #f39c12; -fx-font-weight: bold;" text="â—" />
                            <Label fx:id="lblWarningCount" text="Warning: 0" />
                        </HBox>
                        
                        <Separator orientation="VERTICAL" />
                        
                        <HBox spacing="5">
                            <Label style="-fx-text-fill: #e74c3c; -fx-font-weight: bold;" text="â—" />
                            <Label fx:id="lblIssueCount" text="Issue: 0" />
                        </HBox>
                    </HBox>
                    
                    <!-- Clearance Requests Table -->
                    <TableView fx:id="tableRequests" prefHeight="400" styleClass="table-view">
                        <columns>
                            <TableColumn fx:id="colStudentId" prefWidth="100" text="Student ID" />
                            <TableColumn fx:id="colStudentName" prefWidth="150" text="Student Name" />
                            <TableColumn fx:id="colDepartment" prefWidth="120" text="Department" />
                            <TableColumn fx:id="colRequestDate" prefWidth="120" text="Request Date" />
                            <TableColumn fx:id="colBookStatus" prefWidth="120" text="Book Status" />
                            <TableColumn fx:id="colActions" prefWidth="200" text="Actions" />
                        </columns>
                        <columnResizePolicy>
                            <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                        </columnResizePolicy>
                    </TableView>
                    
                    <!-- Instructions -->
                    <VBox spacing="5" styleClass="instructions-container">
                        <Label style="-fx-font-weight: bold; -fx-text-fill: #2980b9;" text="Instructions:" />
                        <Label style="-fx-text-fill: #2c3e50;" text="1. Review each student's borrowing status in the table above" />
                        <Label style="-fx-text-fill: #2c3e50;" text="2. Click 'Details' to view individual student's book borrowing records" />
                        <Label style="-fx-text-fill: #2c3e50;" text="3. Click 'Approve' if student has no overdue books or fines" />
                        <Label style="-fx-text-fill: #2c3e50;" text="4. Click 'Reject' if student has outstanding library issues" />
                    </VBox>
                </VBox>
            </Tab>
            
            <!-- Borrowing History Tab -->
            <Tab text="ðŸ“š Borrowing History">
                <VBox spacing="15">
                    <padding>
                        <Insets bottom="15.0" left="15.0" right="15.0" top="15.0" />
                    </padding>
                    
                    <!-- Header -->
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <Label styleClass="title-label" text="All Student Borrowing Records" />
                        <Region HBox.hgrow="ALWAYS" />
                        <Button onAction="#refreshBorrowingHistory" prefHeight="35" styleClass="refresh-button" text="ðŸ”„ Refresh History" />
                    </HBox>
                    
                    <!-- Search and Filter -->
                    <HBox alignment="CENTER_LEFT" spacing="10" styleClass="hbox-spaced">
                        <TextField fx:id="txtSearchStudent" promptText="Search by student name or ID" styleClass="search-field" />
                        <Button onAction="#searchBorrowingHistory" styleClass="search-button" text="ðŸ” Search" />
                        <Region HBox.hgrow="ALWAYS" />
                        <ComboBox fx:id="cmbStatusFilter" prefWidth="150" promptText="Filter by Status" />
                        <Button onAction="#clearFilters" styleClass="clear-filters-button" text="Clear Filters" />
                    </HBox>
                    
                    <!-- Borrowing History Table -->
                    <TableView fx:id="tableBorrowingHistory" prefHeight="450" styleClass="table-view">
                        <columns>
                            <TableColumn fx:id="colHistoryStudentId" prefWidth="100" text="Student ID" />
                            <TableColumn fx:id="colHistoryStudentName" prefWidth="150" text="Student Name" />
                            <TableColumn fx:id="colHistoryDepartment" prefWidth="120" text="Department" />
                            <TableColumn fx:id="colHistoryBookTitle" prefWidth="250" text="Book Title" />
                            <TableColumn fx:id="colHistoryBorrowDate" prefWidth="100" text="Borrow Date" />
                            <TableColumn fx:id="colHistoryDueDate" prefWidth="100" text="Due Date" />
                            <TableColumn fx:id="colHistoryStatus" prefWidth="100" text="Status" />
                            <TableColumn fx:id="colHistoryFine" prefWidth="80" text="Fine" />
                        </columns>
                        <columnResizePolicy>
                            <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                        </columnResizePolicy>
                    </TableView>
                    
                    <!-- Summary Stats -->
                    <HBox spacing="30" styleClass="stats-bar">
                        <VBox spacing="5">
                            <Label style="-fx-text-fill: #7f8c8d; -fx-font-size: 12px;" text="Total Borrowed Books" />
                            <Label fx:id="lblTotalBorrowed" styleClass="stat-label" text="0" />
                        </VBox>
                        <VBox spacing="5">
                            <Label style="-fx-text-fill: #7f8c8d; -fx-font-size: 12px;" text="Currently Borrowed" />
                            <Label fx:id="lblCurrentlyBorrowed" styleClass="stat-label-warning" text="0" />
                        </VBox>
                        <VBox spacing="5">
                            <Label style="-fx-text-fill: #7f8c8d; -fx-font-size: 12px;" text="Total Fines" />
                            <Label fx:id="lblTotalFines" styleClass="stat-label-issue" text="0.00 Birr" />
                        </VBox>
                    </HBox>
                </VBox>
            </Tab>
            
            <!-- Student Details Tab -->
            <Tab fx:id="tabStudentDetails" closable="true" onClosed="#handleTabClosed" text="ðŸ‘¤ Student Details">
                <VBox spacing="15" styleClass="vbox-spaced">
                    <padding>
                        <Insets bottom="15.0" left="15.0" right="15.0" top="15.0" />
                    </padding>
                    
                    <!-- Student Header Info -->
                    <VBox spacing="8" styleClass="student-header-container">
                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label styleClass="subtitle-label" text="Student Library Details" />
                            <Region HBox.hgrow="ALWAYS" />
                            <Button onAction="#goBackToRequests" styleClass="neutral-button" text="â¬… Back to Requests" />
                        </HBox>
                        <GridPane hgap="10" vgap="8">
                            <columnConstraints>
                                <ColumnConstraints prefWidth="100" />
                                <ColumnConstraints prefWidth="200" />
                                <ColumnConstraints prefWidth="100" />
                                <ColumnConstraints prefWidth="200" />
                            </columnConstraints>
                            <rowConstraints>
                                <RowConstraints />
                                <RowConstraints />
                                <RowConstraints />
                            </rowConstraints>
                            <children>
                                <Label style="-fx-font-weight: bold;" text="Student ID:" GridPane.columnIndex="0" GridPane.rowIndex="0" />
                                <Label fx:id="lblDetailStudentId" text="" GridPane.columnIndex="1" GridPane.rowIndex="0" />
                                <Label style="-fx-font-weight: bold;" text="Name:" GridPane.columnIndex="2" GridPane.rowIndex="0" />
                                <Label fx:id="lblDetailStudentName" text="" GridPane.columnIndex="3" GridPane.rowIndex="0" />
                                
                                <Label style="-fx-font-weight: bold;" text="Department:" GridPane.columnIndex="0" GridPane.rowIndex="1" />
                                <Label fx:id="lblDetailDepartment" text="" GridPane.columnIndex="1" GridPane.rowIndex="1" />
                                <Label style="-fx-font-weight: bold;" text="Clearance Status:" GridPane.columnIndex="2" GridPane.rowIndex="1" />
                                <Label fx:id="lblDetailStatus" text="" GridPane.columnIndex="3" GridPane.rowIndex="1" />
                                
                                <Label style="-fx-font-weight: bold;" text="Email:" GridPane.columnIndex="0" GridPane.rowIndex="2" />
                                <Label fx:id="lblDetailEmail" text="" GridPane.columnIndex="1" GridPane.rowIndex="2" />
                                <Label style="-fx-font-weight: bold;" text="Phone:" GridPane.columnIndex="2" GridPane.rowIndex="2" />
                                <Label fx:id="lblDetailPhone" text="" GridPane.columnIndex="3" GridPane.rowIndex="2" />
                            </children>
                        </GridPane>
                    </VBox>
                    
                    <!-- Student's Book Details -->
                    <Label styleClass="subtitle-label" text="ðŸ“š Book Borrowing Records" />
                    <TableView fx:id="tableStudentBookDetails" prefHeight="300" styleClass="table-view">
                        <columns>
                            <TableColumn fx:id="colDetailBookTitle" prefWidth="250" text="Book Title" />
                            <TableColumn fx:id="colDetailAuthor" prefWidth="150" text="Author" />
                            <TableColumn fx:id="colDetailBorrowDate" prefWidth="100" text="Borrow Date" />
                            <TableColumn fx:id="colDetailDueDate" prefWidth="100" text="Due Date" />
                            <TableColumn fx:id="colDetailReturnDate" prefWidth="100" text="Return Date" />
                            <TableColumn fx:id="colDetailStatus" prefWidth="100" text="Status" />
                            <TableColumn fx:id="colDetailFine" prefWidth="80" text="Fine" />
                        </columns>
                        <columnResizePolicy>
                            <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                        </columnResizePolicy>
                    </TableView>
                    
                    <!-- Action Buttons -->
                    <HBox alignment="CENTER_RIGHT" spacing="10">
                        <Button fx:id="btnApproveFromDetails" onAction="#approveFromDetails" prefHeight="35" prefWidth="180" styleClass="success-button" text="âœ… Approve Clearance" />
                        <Button fx:id="btnRejectFromDetails" onAction="#rejectFromDetails" prefHeight="35" prefWidth="180" styleClass="danger-button" text="âŒ Reject Clearance" />
                    </HBox>
                </VBox>
            </Tab>
            
        </TabPane>
    </center>
    
    <bottom>
        <HBox alignment="CENTER" styleClass="footer">
            <Label styleClass="footer-label" text="Debre Birhan University Clearance Management System - Library Module v1.0" />
        </HBox>
    </bottom>
    
</BorderPane>
